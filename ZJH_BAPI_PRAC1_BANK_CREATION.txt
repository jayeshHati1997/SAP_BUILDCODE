REPORT ZJH_BAPI_PRAC1.

TYPES: BEGIN OF TY_RECORD,
         COUNTRY     TYPE BAPI1011_KEY-BANK_CTRY,
         BANKKEY     TYPE BAPI1011_KEY-BANK_KEY,
         BANKNAME    TYPE BAPI1011_ADDRESS-BANK_NAME,
         REGION      TYPE BAPI1011_ADDRESS-REGION,
         STREET      TYPE BAPI1011_ADDRESS-STREET,
         CITY        TYPE BAPI1011_ADDRESS-CITY,
         BANK_BRANCH TYPE BAPI1011_ADDRESS-BANK_BRANCH,
       END OF TY_RECORD.

DATA: IT_RECORD  TYPE TABLE OF TY_RECORD,
      WA_RECORD  TYPE TY_RECORD,
      WA_ADDRESS TYPE BAPI1011_ADDRESS,
      WA_RETURN  TYPE BAPIRET2,
      IT_RETURN  TYPE TABLE OF BAPIRET2.

DATA: IT_RAWTAB TYPE TRUXS_T_TEXT_DATA.

PARAMETERS: FILENAME(128) TYPE C.

AT SELECTION-SCREEN ON VALUE-REQUEST FOR FILENAME.
  CALL FUNCTION 'F4_FILENAME'
    EXPORTING
      PROGRAM_NAME  = SYST-CPROG
      DYNPRO_NUMBER = SYST-DYNNR
*     FIELD_NAME    = ' '
    IMPORTING
      FILE_NAME     = FILENAME.

START-OF-SELECTION.
  CALL FUNCTION 'TEXT_CONVERT_XLS_TO_SAP'
    EXPORTING
*     I_FIELD_SEPERATOR    =
      I_LINE_HEADER        = 'X'
      I_TAB_RAW_DATA       = IT_RAWTAB
      I_FILENAME           = FILENAME
    TABLES
      I_TAB_CONVERTED_DATA = IT_RECORD
    EXCEPTIONS
      CONVERSION_FAILED    = 1
      OTHERS               = 2.

  LOOP AT IT_RECORD INTO WA_RECORD.

    WA_ADDRESS-BANK_NAME = WA_RECORD-BANKNAME.
    WA_ADDRESS-REGION = WA_RECORD-REGION.
    WA_ADDRESS-STREET = WA_RECORD-STREET.
    WA_ADDRESS-CITY = WA_RECORD-CITY.
    WA_ADDRESS-BANK_BRANCH = WA_RECORD-BANK_BRANCH.

    CALL FUNCTION 'BAPI_BANK_CREATE'
      EXPORTING
        BANK_CTRY    = WA_RECORD-COUNTRY
        BANK_KEY     = WA_RECORD-BANKKEY
        BANK_ADDRESS = WA_ADDRESS
*       BANK_METHOD  =
*       BANK_FORMATTING                    =
*       BANK_ADDRESS1                      =
*       I_XUPDATE    = 'X'
*       I_CHECK_BEFORE_SAVE                =
*       BANK_IBAN_RULE                     =
*       BANK_B2B_SUPPORTED                 =
*       BANK_COR1_SUPPORTED                =
*       BANK_R_TRANSACTION_SUPPORTED       =
      IMPORTING
        RETURN       = WA_RETURN
*       BANKCOUNTRY  =
*       BANKKEY      =
      .

    IF WA_RETURN IS INITIAL.
      CALL FUNCTION 'BAPI_TRANSACTION_COMMIT'
        EXPORTING
          WAIT = 'X'.
    ELSEIF WA_RETURN-TYPE = 'E'.
      WA_RETURN-ROW = SY-TABIX.
      APPEND WA_RETURN TO IT_RETURN.
    ENDIF.

    CLEAR: WA_RETURN, WA_RECORD, WA_ADDRESS.

  ENDLOOP.

  LOOP AT IT_RETURN INTO WA_RETURN.
    WRITE: 1 WA_RETURN-ROW COLOR 6, 12 WA_RETURN-MESSAGE COLOR 6.
  ENDLOOP.
